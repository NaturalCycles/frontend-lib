import{E as S,S as w}from"./chunks/types.C-9dMxxX.js";import{A as W,T as H,a as N,i as j,U as V,b as D,c as Y,d as z,e as J,f as K,H as x,_ as Q}from"./chunks/string.util.DxuDbFn4.js";import{a as U,b as L,c as $,d as P,e as X,f as B}from"./chunks/object.util.DwjELA91.js";import{d as Z,p as q,h as M,v as ee,o as E,c as k,a as _,F as te,C as se,t as T,j as O,G as C,a0 as re,B as ae}from"./chunks/framework.D_PpXas2.js";import"./chunks/is.util.NvFMntWM.js";function ne(a,e=Error){if(!(a instanceof e))throw new W(`Expected to be instanceof ${e.name}, actual typeof: ${typeof a}`)}function ie(a,e){if(!(a instanceof e))throw a}function I(a,e=Date.now()){return G(e-a)}function G(a){if(a<1e3)return`${Math.round(a)} ms`;if(a<5e3){const n=a/1e3;return`${Math.trunc(n)===n?n:n.toFixed(3)} sec`}const e=Math.floor(a/1e3)%60,t=Math.floor(a/(60*1e3))%60,s=Math.floor(a/(3600*1e3));return s===0?t===0?`${e} sec`:`${t}m${e}s`:s<24?`${s}h${t}m`:s<48?`${Math.round(s+t/60)}h`:`${Math.floor(s/24)} days`}async function oe(a,e){if(!e.timeout)return await a();const{timeout:t,name:s=a.name||"pTimeout function",onTimeout:r}=e,n=e.fakeError||new Error("TimeoutError");return await new Promise(async(o,l)=>{const c=setTimeout(()=>{const h=new H(`"${s}" timed out after ${t} ms`,e.errorData);if(h.stack=n.stack.replace("Error: TimeoutError","TimeoutError: "+h.message),r){try{o(r(h))}catch(i){i.stack=n.stack.replace("Error: TimeoutError",i.name+": "+i.message),l(N(i,e.errorData))}return}l(h)},t);try{o(await a())}catch(h){l(h)}finally{clearTimeout(c)}})}var g;(function(a){a.THROW_IMMEDIATELY="THROW_IMMEDIATELY",a.THROW_AGGREGATED="THROW_AGGREGATED",a.SUPPRESS="SUPPRESS"})(g||(g={}));function le(a,e,t){return a<=e?e:a>=t?t:a}async function ce(a=0,e){return await new Promise((t,s)=>setTimeout(e instanceof Error?s:t,a,e))}const he=["GET","POST","PUT","PATCH","DELETE","HEAD"];var b;const ue={text:"text/plain",json:"application/json",void:"*/*",readableStream:"application/octet-stream",arrayBuffer:"application/octet-stream",blob:"application/octet-stream"},fe={count:2,timeout:1e3,timeoutMax:3e4,timeoutMultiplier:2};class F{constructor(e={}){if(typeof globalThis.fetch!="function")throw new TypeError("globalThis.fetch is not available");this.cfg=this.normalizeCfg(e);for(const t of he){const s=t.toLowerCase();if(this[`${s}Void`]=async(r,n)=>await this.fetch({url:r,method:t,responseType:"void",...n}),t==="HEAD")return;this[`${s}Text`]=async(r,n)=>await this.fetch({url:r,method:t,responseType:"text",...n}),this[s]=async(r,n)=>await this.fetch({url:r,method:t,responseType:"json",...n})}}onBeforeRequest(e){var t;return((t=this.cfg.hooks).beforeRequest||(t.beforeRequest=[])).push(e),this}onAfterResponse(e){var t;return((t=this.cfg.hooks).afterResponse||(t.afterResponse=[])).push(e),this}onBeforeRetry(e){var t;return((t=this.cfg.hooks).beforeRetry||(t.beforeRetry=[])).push(e),this}onError(e){var t;return((t=this.cfg.hooks).onError||(t.onError=[])).push(e),this}static create(e={}){return new b(e)}async getReadableStream(e,t){return await this.fetch({url:e,responseType:"readableStream",...t})}async fetch(e){const t=await this.doFetch(e);if(t.err)throw t.err;return t.body}async expectError(e){const t=await this.doFetch(e);if(!t.err)throw new V("Fetch was expected to error");return ne(t.err,x),t.err}async tryFetch(e){const t=await this.doFetch(e);return t.err?(ie(t.err,x),[t.err,null]):[null,t.body]}async doFetch(e){var d,y,m;const t=this.normalizeOptions(e),{logger:s}=this.cfg,{timeoutSeconds:r,init:{method:n}}=t;for(const f of this.cfg.hooks.beforeRequest||[])await f(t);const l=t.fullUrl.includes("://")?new URL(t.fullUrl):void 0,c=l?this.getShortUrl(l):t.fullUrl,h=[n,c].join(" "),i={req:t,retryStatus:{retryAttempt:0,retryStopped:!1,retryTimeout:t.retry.timeout},signature:h};for(;!i.retryStatus.retryStopped;){t.started=Date.now();let f;if(r){const u=new AbortController;t.init.signal=u.signal,f=setTimeout(()=>{u.abort(new H(`request timed out after ${r} sec`))},r*1e3)}if(t.logRequest){const{retryAttempt:u}=i.retryStatus;s.log([" >>",h,u&&`try#${u+1}/${t.retry.count+1}`].filter(Boolean).join(" ")),t.logRequestBody&&t.init.body&&s.log(t.init.body)}try{i.fetchResponse=await(this.cfg.fetchFn||b.callNativeFetch)(t.fullUrl,t.init),i.ok=i.fetchResponse.ok,i.err=void 0}catch(u){i.err=D(u),i.ok=!1,i.fetchResponse=void 0}finally{clearTimeout(f)}if(i.statusFamily=this.getStatusFamily(i),i.statusCode=(d=i.fetchResponse)==null?void 0:d.status,(y=i.fetchResponse)!=null&&y.ok||!t.throwHttpErrors)try{await oe(async()=>await this.onOkResponse(i),{timeout:r*1e3||Number.POSITIVE_INFINITY,name:"Fetcher.downloadBody"})}catch(u){i.err=D(u),i.ok=!1,await this.onNotOkResponse(i)}else await this.onNotOkResponse(i)}if(i.err){N(i.err,t.errorData),(m=t.onError)==null||m.call(t,i.err);for(const f of this.cfg.hooks.onError||[])await f(i.err)}for(const f of this.cfg.hooks.afterResponse||[])await f(i);return i}async onOkResponse(e){const{req:t}=e,{responseType:s}=e.req;if(s==="json")if(e.fetchResponse.body){const r=await e.fetchResponse.text();r?(e.body=r,e.body=Y(r,t.jsonReviver)):e.body={}}else e.body={};else if(s==="text")e.body=e.fetchResponse.body?await e.fetchResponse.text():"";else if(s==="arrayBuffer")e.body=e.fetchResponse.body?await e.fetchResponse.arrayBuffer():{};else if(s==="blob")e.body=e.fetchResponse.body?await e.fetchResponse.blob():{};else if(s==="readableStream"&&(e.body=e.fetchResponse.body,e.body===null))throw new Error("fetchResponse.body is null");if(e.retryStatus.retryStopped=!0,(!e.err||!t.throwHttpErrors)&&t.logResponse){const{retryAttempt:r}=e.retryStatus,{logger:n}=this.cfg;n.log([" <<",e.fetchResponse.status,e.signature,r&&`try#${r+1}/${t.retry.count+1}`,I(e.req.started)].filter(Boolean).join(" ")),t.logResponseBody&&e.body!==void 0&&n.log(e.body)}}static async callNativeFetch(e,t){return await globalThis.fetch(e,t)}async onNotOkResponse(e){var n;let t;if(!e.body&&e.fetchResponse)try{e.body=z(await e.fetchResponse.text())}catch{}e.err?t=J(e.err):e.body?t=K(e.body):t={name:"Error",message:"Fetch failed",data:{}};let s=((n=e.fetchResponse)==null?void 0:n.status)||0;e.statusFamily===2&&(e.statusFamily=void 0,e.statusCode=void 0,s=0);const r=[e.statusCode,e.signature].filter(Boolean).join(" ");e.err=new x(r,U({response:e.fetchResponse,responseStatusCode:s,requestUrl:e.req.fullUrl,requestBaseUrl:this.cfg.baseUrl||void 0,requestMethod:e.req.init.method,requestSignature:e.signature,requestDuration:Date.now()-e.req.started}),{cause:t}),await this.processRetry(e)}async processRetry(e){var l;const{retryStatus:t}=e;this.shouldRetry(e)||(t.retryStopped=!0);for(const c of this.cfg.hooks.beforeRetry||[])await c(e);const{count:s,timeoutMultiplier:r,timeoutMax:n}=e.req.retry;if(t.retryAttempt>=s&&(t.retryStopped=!0),e.err&&(!t.retryStopped||e.req.logResponse)&&this.cfg.logger.error([" <<",((l=e.fetchResponse)==null?void 0:l.status)||0,e.signature,s&&(t.retryAttempt||!t.retryStopped)&&`try#${t.retryAttempt+1}/${s+1}`,I(e.req.started)].filter(Boolean).join(" ")+`
`,Q(e.err.cause||e.err)),t.retryStopped)return;t.retryAttempt++,t.retryTimeout=le(t.retryTimeout*r,0,n);const o=this.getRetryTimeout(e);e.req.debug&&this.cfg.logger.log(` .. ${e.signature} waiting ${G(o)}`),await ce(o)}getRetryTimeout(e){let t=0;if(e.fetchResponse&&[429,503].includes(e.fetchResponse.status)){const s=e.fetchResponse.headers.get("retry-after")??e.fetchResponse.headers.get("x-ratelimit-reset");if(s){if(Number(s))t=Number(s)*1e3;else{const r=new Date(s);Number.isNaN(r)||(t=Number(r)-Date.now())}this.cfg.logger.log(`retry-after: ${s}`),t||this.cfg.logger.warn("retry-after could not be parsed")}}if(!t){const s=Math.random()*500;t=e.retryStatus.retryTimeout+s}return t}shouldRetry(e){var h,i,d,y,m;const{retryPost:t,retry3xx:s,retry4xx:r,retry5xx:n}=e.req,{method:o}=e.req.init;if(o==="POST"&&!t)return!1;const{statusFamily:l}=e,c=((h=e.fetchResponse)==null?void 0:h.status)||0;return l===5&&!n?!1:[408,429].includes(c)?!0:!(l===4&&!r||l===3&&!s||(m=(y=(d=(i=e.err)==null?void 0:i.cause)==null?void 0:d.cause)==null?void 0:y.message)!=null&&m.includes("unexpected redirect"))}getStatusFamily(e){var s;const t=(s=e.fetchResponse)==null?void 0:s.status;if(t){if(t>=500)return 5;if(t>=400)return 4;if(t>=300)return 3;if(t>=200)return 2;if(t>=100)return 1}}getShortUrl(e){const{baseUrl:t}=this.cfg;e.password&&(e=new URL(e.toString()),e.password="[redacted]");let s=e.toString();return this.cfg.logWithSearchParams||(s=s.split("?")[0]),!this.cfg.logWithBaseUrl&&t&&s.startsWith(t)&&(s=s.slice(t.length)),s}normalizeCfg(e){var r;(r=e.baseUrl)!=null&&r.endsWith("/")&&(console.warn(`Fetcher: baseUrl should not end with slash: ${e.baseUrl}`),e.baseUrl=e.baseUrl.slice(0,e.baseUrl.length-1));const{debug:t=!1}=e,s=L({baseUrl:"",inputUrl:"",responseType:"json",searchParams:{},timeoutSeconds:30,retryPost:!1,retry3xx:!1,retry4xx:!1,retry5xx:!0,logger:e.logger||console,debug:t,logRequest:t,logRequestBody:t,logResponse:t,logResponseBody:t,logWithBaseUrl:j(),logWithSearchParams:!0,retry:{...fe},init:{method:e.method||"GET",headers:U({"user-agent":b.userAgent,...e.headers}),credentials:e.credentials,redirect:e.redirect},hooks:{},throwHttpErrors:!0,errorData:{}},$(e,["method","credentials","headers","redirect","logger"]));return s.init.headers=P(s.init.headers,n=>n.toLowerCase()),s}normalizeOptions(e){var t;const s={...X(this.cfg,["timeoutSeconds","retryPost","retry4xx","retry5xx","responseType","jsonReviver","logRequest","logRequestBody","logResponse","logResponseBody","debug","throwHttpErrors","errorData"]),started:Date.now(),...$(e,["method","headers","credentials"]),inputUrl:e.url||"",fullUrl:e.url||"",retry:{...this.cfg.retry,...B(e.retry||{})},init:L({...this.cfg.init,headers:{...this.cfg.init.headers},method:e.method||this.cfg.init.method,credentials:e.credentials||this.cfg.init.credentials,redirect:e.redirect||this.cfg.init.redirect||"follow"},{headers:P(e.headers||{},o=>o.toLowerCase())})};U(s.init.headers,!0);const r=e.baseUrl||this.cfg.baseUrl;r&&(s.fullUrl.startsWith("/")&&(console.warn("Fetcher: url should not start with / when baseUrl is specified"),s.fullUrl=s.fullUrl.slice(1)),s.fullUrl=`${r}/${s.inputUrl}`);const n=B({...this.cfg.searchParams,...e.searchParams});if(Object.keys(n).length){const o=new URLSearchParams(n).toString();s.fullUrl+=(s.fullUrl.includes("?")?"&":"?")+o}return e.json!==void 0?(s.init.body=JSON.stringify(e.json),s.init.headers["content-type"]="application/json"):e.text!==void 0?(s.init.body=e.text,s.init.headers["content-type"]="text/plain"):e.form?e.form instanceof URLSearchParams||e.form instanceof FormData?s.init.body=e.form:(s.init.body=new URLSearchParams(e.form),s.init.headers["content-type"]="application/x-www-form-urlencoded"):e.body!==void 0&&(s.init.body=e.body),(t=s.init.headers).accept||(t.accept=ue[s.responseType]),s}}b=F;F.VERSION=2;F.userAgent=j()?`fetcher${b.VERSION}`:void 0;function de(a={}){return F.create(a)}async function pe(a,e,t={}){const s=[...a],r=s.length;if(r===0)return[];const{concurrency:n=1/0,errorMode:o=g.THROW_IMMEDIATELY,logger:l=console}=t;if(n===1)return await ye(s,e,o,l);if(s.length<=n)return await ge(s,e,o,l);const c=[],h=[];let i=!1,d=0,y=0;return await new Promise((m,f)=>{const u=()=>{if(i)return;const R=s[y],A=y++;if(y>r){if(d===0){i=!0;const p=c.filter(v=>v!==w);h.length?f(new AggregateError(h,`pMap resulted in ${h.length} error(s)`)):m(p)}return}d++,Promise.resolve(R).then(async p=>await e(p,A)).then(p=>{if(p===S)return i=!0,m(c.filter(v=>v!==w));c[A]=p,d--,u()},p=>{o===g.THROW_IMMEDIATELY?(i=!0,f(p)):(o===g.THROW_AGGREGATED?h.push(p):l==null||l.error(p),d--,u())})};for(let R=0;R<n&&(u(),!i);R++);})}async function ye(a,e,t,s){let r=0;const n=[],o=[];for(const l of a)try{const c=await e(l,r++);if(c===S)break;c!==w&&n.push(c)}catch(c){if(t===g.THROW_IMMEDIATELY)throw c;t===g.THROW_AGGREGATED?o.push(c):s==null||s.error(c)}if(o.length)throw new AggregateError(o,`pMap resulted in ${o.length} error(s)`);return n}async function ge(a,e,t,s){if(t===g.THROW_IMMEDIATELY)return(await Promise.all(a.map((o,l)=>e(o,l)))).filter(o=>o!==w&&o!==S);const r=[],n=[];for(const o of await Promise.allSettled(a.map((l,c)=>e(l,c))))if(o.status==="fulfilled"){if(o.value===S)break;o.value!==w&&r.push(o.value)}else t===g.THROW_AGGREGATED?n.push(o.reason):s==null||s.error(o.reason);if(n.length)throw new AggregateError(n,`pMap resulted in ${n.length} error(s)`);return r}class me{constructor(e){this.fetcher=e}async load(e){return await this.fetcher.get(`${e}.json`)}}const Ee=a=>(console.warn(`[tr] missing: ${a}`),`[${a}]`);class ke{constructor(e,t={}){this.cfg={...e,missingTranslationHandler:Ee},this.locales={...t},this.currentLocale=e.currentLocale||e.defaultLocale}setLocale(e,t){this.locales[e]=t}getLocale(e){return this.locales[e]}async loadLocale(e){const t=Array.isArray(e)?e:[e];await pe(t,async s=>{this.locales[s]||(this.locales[s]=await this.cfg.translationLoader.load(s))})}translate(e,t){return this.translateIfExists(e,t)||this.cfg.missingTranslationHandler(e,t)}translateIfExists(e,t){var s,r;return((s=this.locales[this.currentLocale])==null?void 0:s[e])||((r=this.locales[this.cfg.defaultLocale])==null?void 0:r[e])}}const be={class:"app-content"},we={key:0},Re={key:1},Te=["disabled","onClick"],Se=Z({__name:"TranslationDemo",setup(a){const e=q(new ke({defaultLocale:"en",currentLocale:"en",supportedLocales:["en","ru"],translationLoader:new me(de({baseUrl:"lang"}))})),t=q(!0),s=M(()=>e.value.translate("key1")),r=M(()=>e.value.translate("key2"));return ee(async()=>{await e.value.loadLocale(["en","ru"]),t.value=!1}),(n,o)=>(E(),k("div",be,[t.value?(E(),k("div",we,"Loading...")):(E(),k("pre",Re,[o[0]||(o[0]=_("translationService.currentLocale == ")),(E(!0),k(te,null,se(e.value.cfg.supportedLocales,l=>(E(),k("button",{disabled:e.value.currentLocale===l,onClick:c=>e.value.currentLocale=l},T(l),9,Te))),256)),_(`
key1: "`+T(s.value)+`"
key2: "`+T(r.value)+`"

translationService.locales: `+T(e.value.locales)+`
`,1)]))]))}}),_e={id:"translationservice",tabindex:"-1"},Le=JSON.parse('{"title":"TranslationService","description":"","frontmatter":{},"headers":[],"relativePath":"translation.md","filePath":"translation.md"}'),Fe={name:"translation.md"},$e=Object.assign(Fe,{setup(a){return(e,t)=>{const s=ae("Badge");return E(),k("div",null,[O("h1",_e,[t[0]||(t[0]=_("TranslationService ")),C(s,{text:"experimental",type:"warning"}),t[1]||(t[1]=_()),t[2]||(t[2]=O("a",{class:"header-anchor",href:"#translationservice","aria-label":'Permalink to "TranslationService <Badge text="experimental" type="warning"/>"'},"​",-1))]),t[3]||(t[3]=re(`<h2 id="demo" tabindex="-1">Demo <a class="header-anchor" href="#demo" aria-label="Permalink to &quot;Demo&quot;">​</a></h2><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> translationService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TranslationService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  defaultLocale: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;en&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  supportedLocales: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;en&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ru&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  translationLoader: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FetchTranslationLoader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    prefixUrl: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;lang&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">translationService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">translate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;key1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// value 1 en</span></span></code></pre></div>`,2)),C(Se)])}}});export{Le as __pageData,$e as default};
